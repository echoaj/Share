- name: Display Agent Information
  ansible.builtin.debug:
    msg: >-
      System: {{ item.EPOComputerProperties.ComputerName }}
      | IP: {{ item.EPOComputerProperties.IPAddress | default('N/A') }}
      | AgentGUID: {{ item.EPOAgentProperties.AgentGUID | default('NOT INSTALLED') }}
      | AgentVersion: {{ item.EPOAgentProperties.AgentVersion | default('N/A') }}
  loop: "{{ cleaned_json.result.list.row | default([]) }}"
  loop_control:
    label: "{{ item.EPOComputerProperties.ComputerName }}"

- name: Show keys in first row (sanity check)
  ansible.builtin.debug:
    var: cleaned_json.result.list.row[0].keys()
  when: (cleaned_json.result.list.row | default([])) | length > 0