- name: Read server.ini
  ansible.windows.slurp:
    src: C:\Program Files (x86)\Trellix\ePolicy Orchestrator\DB\server.ini
  register: server_conf

- name: Decode content
  ansible.builtin.set_fact:
    server_info: "{{ server_conf['content'] | b64decode }}"

- name: Check for SecureHttpPort
  ansible.builtin.debug:
    msg: "SecureHttpPort=8443 FOUND"
  when: "'SecureHttpPort=8443' in server_info"

- name: Fail if port missing
  ansible.builtin.fail:
    msg: "SecureHttpPort=8443 NOT found in server.ini"
  when: "'SecureHttpPort=8443' not in server_info"
