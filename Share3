# Create a COM object for the Windows Update Session
$UpdateSession = New-Object -ComObject Microsoft.Update.Session

# Create an update searcher object from the session
$UpdateSearcher = $UpdateSession.CreateUpdateSearcher()

# Query the history, index starts from 0 and can retrieve up to the number of updates you specify
$HistoryCount = $UpdateSearcher.GetTotalHistoryCount()
$UpdateHistory = $UpdateSearcher.QueryHistory(0, $HistoryCount)

# Filter and display the updates based on the category
$UpdateHistory | Where-Object {
    $_.Categories -match 'Critical Updates' -or
    $_.Categories -match 'Definition Updates' -or
    $_.Categories -match 'Security Updates'
} | ForEach-Object {
    [PSCustomObject]@{
        Title = $_.Title
        Description = $_.Description
        Operation = switch ($_.Operation) {
            1 {'Installation'}
            2 {'Uninstallation'}
            3 {'Other'}
        }
        Date = $_.Date
        Categories = ($_.Categories | ForEach-Object { $_.Name }) -join ', '
        ResultCode = switch ($_.ResultCode) {
            1 {'In Progress'}
            2 {'Succeeded'}
            3 {'Succeeded With Errors'}
            4 {'Failed'}
            5 {'Aborted'}
        }
    }
} | Format-Table -AutoSize