- name: Read inputs.conf
  ansible.builtin.slurp:
    src: 'C:\Program Files\SplunkUniversalForwarder\etc\system\local\inputs.conf'
  register: inputs_b64

- name: Decode inputs.conf
  ansible.builtin.set_fact:
    inputs_text: "{{ inputs_b64.content | b64decode }}"

- name: Read inputs.conf
  ansible.builtin.slurp:
    src: 'C:\Program Files\SplunkUniversalForwarder\etc\system\local\inputs.conf'
  register: inputs_b64

- name: Decode inputs.conf
  ansible.builtin.set_fact:
    inputs_text: "{{ inputs_b64.content | b64decode }}"

# Look for any uncommented line with "disabled = 0" or "disabled = false"
- name: Check if any input is enabled
  ansible.builtin.set_fact:
    has_enabled: >-
      {{
        (inputs_text |
         regex_search('(?im)^\\s*(?!#)\\s*disabled\\s*=\\s*(0|false)\\s*$')
        ) is not none
      }}

- name: Fail if no enabled inputs found
  ansible.builtin.fail:
    msg: "inputs.conf has no enabled lines (disabled = 0/false)."
  when: not has_enabled